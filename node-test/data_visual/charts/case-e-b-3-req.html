<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/9/2023, 6:40:54 PM", "9/9/2023, 6:35:31 PM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49","00:03:50"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[1,10,20,30,40,49,50,50,50,50,51,60,70,80,90,99,100,100,100,100,101,110,120,130,140,149,150,150,150,150,151,160,170,180,190,199,200,200,200,200,201,210,220,230,240,249,250,250,250,250,251,260,270,280,290,299,300,300,300,300,301,310,320,330,340,349,350,350,350,350,351,360,370,381,389,399,400,400,400,400,401,411,420,429,441,448,450,450,450,450,452,459,471,479,491,498,500,501,500,500,500,511,520,529,541,549,550,550,549,550,552,560,570,580,590,599,599,601,600,600,601,610,620,630,640,648,651,650,650,650,651,660,670,680,690,699,700,700,696,704,701,710,720,730,740,749,750,750,750,750,751,760,768,782,790,799,800,800,800,800,802,810,819,831,840,848,850,850,850,850,850,861,871,879,890,900,899,900,900,901,900,910,920,930,941,949,949,950,951,950,951,960,969,980,991,999,999,1000,1001,1000,995,966,934,900,867,833,800,767,733,699,667,634,599,567,534,499,467,433,400,367,333,300,267,233,200,166,133,100,67,33,4],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[1,9,20,30,40,48,50,49,51,50,51,60,69,81,89,99,96,101,101,100,101,112,114,118,119,117,125,117,123,117,112,122,112,93,120,106,106,111,111,111,118,121,100,111,99,107,161,171,213,241,233,244,244,250,252,269,253,237,235,237,235,234,241,212,236,240,230,227,232,255,241,230,221,216,231,236,284,310,325,375,406,406,421,426,432,436,437,445,445,436,437,433,430,453,439,441,448,464,455,447,456,434,464,460,440,411,469,491,549,544,555,554,573,560,603,590,584,587,594,591,601,588,600,592,576,618,615,621,597,597,611,591,619,624,550,627,600,600,602,635,600,586,624,589,627,585,603,599,600,590,595,569,636,585,593,583,590,581,594,579,578,597,584,567,587,568,554,550,566,585,588,553,594,575,566,580,557,574,497,586,542,564,570,548,544,532,548,555,541,551,529,544,564,574,556,558,552,545,502,529,567,480,611,565,573,562,587,560,584,626,579,586,597,542,534,494,472,439,399,366,334,303,267,235,200,167,134,101,67,34,4],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,25,35,20,35,29,31,40,37,58,80,78,90,93,89,86,85,87,89,113,128,137,152,80,86,34,11,16,17,23,35,26,33,46,59,73,58,66,77,77,99,122,113,118,122,122,97,103,132,149,157,159,176,120,86,67,30,1,1,1,2,2,15,11,3,6,11,15,30,44,16,60,52,53,38,43,55,48,66,56,80,93,151,71,65,2,3,0,0,2,0,4,8,11,13,6,13,1,16,29,34,53,34,32,30,47,60,41,72,54,61,92,113,88,102,98,74,91,130,91,133,120,144,173,143,154,166,154,133,185,190,206,205,213,223,213,202,245,198,242,264,242,307,290,293,245,264,279,303,301,306,300,337,345,315,381,343,358,343,344,377,393,407,421,388,419,366,439,329,448,435,440,457,440,468,473,487,444,365,425,357,301,273,209,209,146,89,84,56,5,24,2,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[34,23,15,14,14,14,14,15,15,13,13,13,19,17,23,24,28,24,27,25,25,29,38,43,63,47,48,48,52,49,52,53,64,77,61,65,61,60,65,54,60,57,64,65,72,52,68,70,39,46,57,46,45,63,55,53,55,63,52,54,50,55,52,61,60,56,60,62,58,52,54,53,57,66,65,44,48,39,38,43,32,31,36,35,34,37,37,36,38,42,40,38,43,39,42,43,44,37,42,45,43,47,41,43,47,38,38,41,35,29,29,30,32,29,30,34,36,38,36,35,34,35,37,38,43,41,38,39,42,40,38,46,44,46,45,48,45,50,48,43,48,48,43,54,51,50,54,51,53,54,51,48,56,54,53,55,57,60,56,57,62,53,62,62,60,60,63,63,53,58,59,60,67,63,61,65,66,66,82,67,68,68,71,76,82,83,80,78,87,95,84,75,95,94,95,107,103,97,100,95,90,79,87,70,77,68,59,59,58,46,48,48,30,40,28,36,26,26,20,25,19,19,17,19,15,16,15,14,14,15,15],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
