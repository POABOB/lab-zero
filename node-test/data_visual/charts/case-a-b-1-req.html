<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/9/2023, 3:24:24 PM", "9/9/2023, 3:18:18 PM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:19","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[3,13,22,33,43,50,50,50,50,50,53,63,73,83,93,99,101,100,100,99,104,113,122,133,143,150,150,150,150,150,153,163,173,183,193,200,200,200,199,201,203,213,223,232,243,250,250,250,250,250,253,263,273,283,293,300,299,283,262,284,303,282,322,333,343,350,350,350,350,350,353,363,373,383,393,400,399,401,399,401,403,413,422,433,443,450,449,451,450,450,453,463,467,347,378,306,463,412,395,481,399,431,463,534,542,548,552,550,550,550,553,563,573,583,593,599,601,598,602,600,603,612,623,634,642,650,650,650,650,650,653,663,673,683,693,700,700,700,699,701,703,713,723,732,743,750,750,750,750,750,753,762,774,783,793,800,800,800,800,800,803,813,823,833,843,849,850,850,850,850,853,863,873,883,893,900,900,900,900,900,903,912,924,933,942,950,950,950,950,950,953,963,973,983,993,1000,442,548,278,422,322,403,340,364,342,375,369,334,375,390,332,333,363,383,365,387,357,324,290,257,224,190,157,124,90,57,24],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[3,12,23,33,43,49,50,50,50,51,53,62,73,83,89,101,100,99,101,99,99,114,122,124,113,121,87,113,95,92,92,84,59,59,57,71,60,40,33,53,43,55,52,43,41,73,239,219,236,262,279,235,243,286,179,151,184,177,148,76,77,121,65,104,175,73,98,113,159,121,101,110,122,128,115,101,85,110,153,98,92,98,95,54,69,56,39,63,91,61,186,185,230,136,270,277,442,406,352,386,360,400,375,433,348,390,393,305,328,302,318,313,320,322,329,355,378,274,286,286,268,269,281,271,306,259,294,315,329,281,277,308,293,293,289,280,310,288,286,293,291,295,262,297,266,293,294,295,295,300,309,304,289,283,272,282,290,288,273,309,275,320,280,262,257,317,307,313,294,284,307,306,282,297,269,306,273,269,278,287,278,259,256,240,239,223,259,261,267,265,290,250,248,252,208,225,132,137,217,282,300,373,335,362,340,319,361,331,368,384,332,305,299,263,293,383,342,374,393,420,335,195,159,125,90,58,24],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,30,53,45,56,60,62,63,94,135,142,133,136,140,169,156,167,130,186,156,163,126,6,7,3,5,9,15,6,5,24,17,44,110,101,265,198,205,241,287,259,466,267,250,192,219,254,254,223,277,265,303,308,303,254,273,313,296,352,325,380,347,385,382,303,342,272,231,190,148,95,29,52,19,50,47,46,29,174,206,299,260,166,265,232,243,235,244,247,248,273,251,226,334,317,305,319,374,343,349,340,352,392,339,301,395,366,350,384,368,421,424,369,387,463,382,411,430,463,432,463,468,448,436,466,432,433,495,477,453,565,509,507,509,514,477,534,479,565,540,576,548,538,540,550,538,557,572,571,566,616,586,648,629,636,600,611,632,670,707,670,731,667,689,648,741,676,682,728,705,781,754,368,183,69,117,22,30,5,2,2,56,8,3,7,6,0,28,64,128,65,71,2,0,0,0,9,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[9,8,7,7,8,7,7,7,7,9,7,7,13,8,14,22,24,18,23,21,17,38,35,53,94,115,147,165,148,106,149,159,186,276,205,166,181,175,551,436,240,300,267,386,740,524,748,752,818,805,818,664,638,700,789,988,1303,1182,1121,1063,119,689,319,1731,2122,1465,159,214,178,219,222,245,191,231,268,219,255,217,210,245,244,258,318,414,447,601,596,718,788,1088,1006,1076,1186,1244,1395,1425,1471,1183,1124,1100,1308,1232,1170,1049,606,332,137,98,91,78,96,100,102,101,117,104,93,67,82,51,86,91,66,92,86,69,102,78,95,86,92,88,80,93,93,81,87,102,93,79,94,80,88,87,102,95,95,104,111,110,105,110,121,120,110,115,129,126,132,153,133,137,143,165,163,170,171,164,184,184,172,171,195,177,200,184,263,184,197,187,191,217,229,220,243,262,253,263,283,282,234,282,259,320,312,284,300,1999,1809,489,1173,1422,1427,1354,1260,1410,1348,1323,1291,1360,1398,1362,1255,992,1220,1305,1236,1215,1110,820,196,14,14,6,6,6,7],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
