<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/10/2023, 8:46:23 AM", "9/10/2023, 8:41:23 AM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[3,13,23,33,43,49,50,50,50,50,54,62,73,83,93,100,100,100,100,100,103,113,123,133,143,150,150,150,150,150,153,163,173,183,193,200,200,200,200,200,203,213,223,233,243,250,250,250,250,250,253,263,273,283,293,300,300,300,300,300,303,313,323,333,343,350,350,350,349,351,353,363,373,383,392,400,401,399,400,400,404,413,422,433,444,449,450,450,450,450,454,463,473,483,493,499,500,500,500,500,503,513,523,533,543,550,550,550,550,550,553,563,573,583,593,600,600,600,600,600,603,613,623,633,643,650,650,650,650,650,653,663,673,683,684,709,700,700,700,700,703,713,723,733,742,750,751,750,750,750,752,764,773,783,793,800,799,800,800,800,804,813,823,833,843,849,850,848,852,849,855,863,873,883,892,900,900,901,899,900,903,913,924,932,944,949,950,949,951,950,953,962,974,983,993,1000,1000,1000,1000,1000,990,956,923,890,858,822,791,757,723,690,657,623,590,557,523,491,456,424,390,356,324,290,257,223,190,157,124,90,56,24],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[2,13,23,33,42,50,50,50,50,50,53,63,73,83,92,101,100,100,100,100,102,112,120,128,123,124,134,137,139,123,128,135,128,134,121,141,134,122,130,105,149,155,191,200,205,201,195,206,183,207,198,197,194,202,185,192,240,189,279,302,301,311,313,319,341,323,341,329,330,328,338,355,374,385,378,404,401,395,403,401,411,414,404,435,425,435,454,432,449,437,447,460,437,452,459,474,446,456,449,457,468,461,459,463,456,438,452,437,473,453,474,507,481,496,541,604,596,601,597,588,613,617,615,623,625,627,611,640,636,630,620,645,634,625,598,640,629,635,647,629,626,622,627,617,643,632,620,655,630,634,605,582,651,618,611,599,606,617,605,621,612,596,603,588,585,584,564,583,656,609,613,626,593,597,579,585,580,597,586,563,573,572,601,573,568,568,552,565,573,524,605,561,553,557,558,550,555,559,578,593,534,625,584,565,583,569,637,612,618,640,614,583,629,561,528,491,460,425,391,356,325,291,257,224,190,158,124,90,58,24],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,22,18,25,8,15,25,24,24,49,47,70,62,62,76,73,93,58,51,41,23,41,40,63,38,62,55,51,62,76,92,105,108,64,116,15,1,0,0,2,9,11,24,11,23,22,16,17,11,0,1,10,1,0,0,0,0,0,0,0,5,7,18,4,8,8,6,10,3,32,28,30,35,51,36,54,46,34,54,61,59,94,111,93,118,86,100,87,40,110,84,41,8,1,0,0,0,0,0,0,4,16,21,34,18,23,14,16,39,38,51,53,93,74,69,53,58,96,66,105,118,109,111,141,84,119,118,146,149,154,160,178,206,195,169,208,175,183,223,215,224,252,256,241,289,258,239,241,229,287,289,313,307,327,288,325,316,329,366,327,344,371,396,383,353,402,357,416,422,418,421,427,472,431,445,421,406,449,334,354,311,273,207,218,152,112,58,39,0,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[15,12,12,12,11,11,11,12,11,12,12,13,13,11,12,14,13,15,14,12,13,20,23,37,42,46,50,41,42,48,43,44,49,56,47,43,46,51,48,63,37,51,52,44,55,50,68,46,69,54,46,54,56,58,55,52,36,47,26,38,31,32,34,38,44,43,43,46,43,43,40,36,32,32,41,36,24,23,24,24,19,13,23,30,35,36,30,31,36,35,36,38,41,47,44,45,48,44,46,42,44,41,48,46,51,47,51,55,49,40,30,32,29,33,29,29,23,26,26,34,31,25,31,39,44,43,47,37,45,41,44,45,44,48,50,52,54,55,46,48,53,51,53,70,54,54,53,48,54,52,57,58,58,59,60,63,64,68,62,57,61,65,62,66,66,62,65,72,73,68,71,58,70,71,72,70,85,62,74,72,74,74,67,74,75,89,82,82,86,75,83,79,84,77,87,82,114,90,79,78,74,62,89,78,73,59,70,64,57,45,49,48,35,27,15,23,12,16,12,12,15,12,12,11,13,12,12,12,13,13],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
