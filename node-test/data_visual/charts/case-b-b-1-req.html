<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/9/2023, 4:23:14 PM", "9/9/2023, 4:17:16 PM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[6,17,27,36,47,50,50,50,50,50,57,66,77,87,96,100,100,100,100,101,106,117,127,136,147,150,150,150,150,150,157,166,177,187,196,200,200,200,200,200,207,217,226,237,247,250,250,250,250,250,256,267,277,287,296,300,300,300,300,300,307,317,326,337,346,350,351,350,350,350,356,367,377,387,396,400,400,400,400,400,407,417,426,437,447,449,450,451,450,450,456,467,477,486,497,500,500,500,500,500,507,516,527,537,546,550,551,550,549,551,556,567,576,587,597,600,600,600,600,600,607,617,626,637,646,650,650,650,650,650,657,667,677,686,697,699,701,700,700,700,707,716,727,737,746,750,750,750,749,752,756,767,776,787,797,800,800,799,801,800,807,816,827,836,847,850,850,850,850,850,857,867,877,886,897,899,900,901,900,900,906,917,926,936,948,950,950,950,950,950,957,967,976,986,997,999,1001,1000,1000,1000,977,945,911,878,844,811,778,743,712,678,645,610,578,545,510,478,445,411,377,345,311,277,245,211,178,144,111,78,44,11],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[6,17,26,35,48,50,50,50,50,50,56,66,78,87,93,100,102,101,100,100,104,117,122,133,115,99,106,110,118,101,106,91,90,84,82,60,68,67,78,68,69,65,72,59,63,54,48,40,44,127,126,179,78,116,97,153,244,239,336,274,281,291,286,312,317,320,273,292,321,306,279,269,258,252,233,236,245,322,351,376,364,328,368,333,318,312,308,313,307,306,272,283,283,260,342,442,493,466,509,501,515,507,520,521,471,422,422,391,408,426,452,501,538,545,597,606,609,601,595,612,595,619,612,628,613,549,506,550,538,524,484,510,513,513,452,473,446,497,470,512,474,459,452,442,436,419,446,439,423,423,393,427,439,385,399,375,406,361,416,390,387,388,395,378,373,370,334,369,331,378,368,354,337,323,333,305,335,347,289,340,272,327,276,300,312,275,287,323,280,263,325,281,255,279,286,252,297,267,291,295,330,302,365,368,374,444,468,478,489,518,519,581,601,556,512,482,441,418,378,345,312,277,246,212,178,145,111,79,45,11],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,22,44,48,43,32,47,50,68,93,76,126,142,129,137,124,120,135,152,152,180,172,197,185,233,207,62,61,55,69,130,255,123,105,268,48,27,25,26,30,32,20,22,55,74,47,26,62,101,115,120,154,189,146,112,42,32,27,83,62,79,109,140,154,157,129,160,165,177,198,219,180,72,27,14,7,0,0,0,0,4,24,131,155,139,156,147,96,82,29,63,2,0,0,0,0,0,0,0,0,0,8,92,116,118,118,116,153,165,158,189,225,234,228,233,224,187,225,258,260,269,323,334,310,312,305,358,325,349,344,405,374,432,389,429,384,425,410,405,436,447,483,441,550,484,459,514,518,482,551,553,547,590,563,519,570,597,626,600,624,693,610,646,695,603,674,677,618,670,723,682,743,767,624,768,727,650,662,645,601,570,445,398,376,294,233,209,128,57,6,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[28,13,11,12,11,12,12,13,11,12,13,14,12,12,13,14,16,18,14,13,15,24,29,52,100,134,138,113,96,140,116,121,172,137,203,224,226,149,187,233,159,262,182,216,182,343,420,258,246,302,362,763,275,932,167,107,448,185,264,34,36,39,50,36,41,72,101,109,98,75,108,118,124,120,129,150,117,121,85,77,81,121,105,111,142,178,169,129,122,124,137,124,139,128,139,85,66,54,53,44,40,40,43,67,94,127,127,120,117,106,89,83,71,78,47,42,30,24,25,29,25,33,25,47,62,112,116,105,100,114,123,130,123,136,126,140,128,143,125,129,129,138,158,184,167,163,156,164,159,182,173,178,189,191,195,207,188,187,189,194,181,207,203,233,210,215,256,225,240,232,203,269,224,221,278,251,255,279,306,343,265,263,341,282,307,291,339,329,334,312,305,293,348,382,326,342,384,389,360,346,416,468,435,365,354,359,282,218,202,174,120,102,54,21,22,13,16,12,12,15,12,11,11,13,12,12,12,12,12,12],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
