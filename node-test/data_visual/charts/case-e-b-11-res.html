<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/10/2023, 9:29:06 AM", "9/10/2023, 9:22:13 AM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[4,15,25,35,45,50,50,50,50,50,55,65,75,85,95,100,100,100,100,100,105,115,125,135,145,150,150,150,150,150,155,164,175,186,194,201,199,200,200,200,205,215,225,235,245,250,250,250,250,250,255,265,275,285,295,300,300,300,300,300,305,315,325,335,345,350,350,349,350,351,355,364,376,384,395,400,400,400,400,400,405,415,425,435,445,450,450,450,450,450,455,465,475,485,495,500,500,500,500,500,504,516,524,535,546,549,550,551,550,550,555,564,576,584,595,600,600,600,600,600,605,615,625,635,645,650,650,650,650,650,653,667,675,685,695,700,700,699,701,700,705,714,726,735,745,750,750,750,750,749,755,766,775,784,796,799,800,800,800,801,804,814,824,837,845,850,850,850,850,850,855,864,876,885,895,900,900,900,899,901,905,915,924,935,946,950,950,950,947,951,955,967,974,985,995,1001,1000,999,1001,1000,983,950,917,883,851,816,784,750,717,683,650,617,584,550,517,483,451,416,384,350,317,283,251,216,184,150,117,83,51,16],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[4,15,25,34,45,50,50,49,51,50,55,64,76,84,94,100,99,100,102,98,103,111,122,125,118,120,112,122,131,121,124,126,121,109,112,119,110,105,122,111,103,109,105,108,100,102,115,157,232,234,244,251,261,259,239,263,248,253,237,231,231,240,245,242,226,233,242,227,232,222,234,232,241,230,247,215,317,334,323,312,389,377,377,386,390,354,367,374,367,374,364,367,356,468,473,487,479,507,484,492,514,502,479,513,486,496,482,432,501,542,552,573,565,588,593,596,571,632,593,596,611,608,604,628,620,614,603,614,620,597,625,602,617,626,610,614,608,616,591,593,634,615,638,599,617,605,607,658,603,611,600,605,632,610,609,602,604,605,601,591,608,638,601,592,626,613,575,604,603,599,580,577,578,572,606,586,573,581,594,604,532,598,557,526,564,575,543,531,584,594,564,546,578,556,539,552,527,524,530,530,478,631,587,584,562,539,653,586,618,627,612,565,601,549,520,488,448,387,418,350,315,288,250,218,184,151,117,84,51,17],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,11,27,23,38,31,25,24,29,37,58,70,82,86,89,94,79,89,103,103,105,141,143,136,162,80,12,20,9,13,18,30,44,46,43,50,66,69,66,73,86,94,105,129,111,117,127,123,122,136,128,157,153,194,73,57,74,94,20,36,39,51,63,84,85,71,101,60,107,104,116,15,11,8,26,3,8,5,1,7,35,34,49,66,62,133,44,8,0,0,0,0,0,0,0,0,0,3,4,0,1,20,20,42,51,37,33,39,31,57,65,59,84,86,91,97,95,102,85,94,92,130,130,147,121,109,144,123,176,145,147,185,177,194,209,189,209,203,171,192,219,250,223,242,259,263,229,251,284,278,315,289,299,308,328,322,312,281,370,339,372,392,348,427,379,329,406,403,397,419,399,429,461,446,462,479,473,457,401,453,327,303,292,217,182,172,113,48,48,6,38,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[18,15,14,14,13,13,16,14,14,14,14,15,14,16,22,25,28,28,20,25,28,37,43,43,47,49,55,54,41,46,48,49,61,59,60,66,65,50,55,59,81,65,67,81,65,55,61,23,39,45,47,43,49,58,60,60,62,47,53,52,53,47,54,56,56,64,53,60,58,60,59,59,54,65,58,29,38,54,56,49,46,51,51,52,48,57,55,52,49,48,51,38,28,32,39,40,43,41,39,36,38,39,46,48,45,49,49,27,25,27,26,24,31,31,30,31,30,31,34,38,34,33,37,40,44,46,47,44,46,47,44,49,42,50,47,48,49,50,54,51,46,51,51,56,53,55,59,48,53,54,61,65,56,65,62,60,64,67,62,61,56,56,64,66,61,61,66,65,62,63,70,71,72,72,71,64,70,72,71,70,88,72,71,84,82,81,71,64,76,69,80,79,73,84,94,81,104,85,87,89,72,75,73,71,75,63,56,60,60,41,48,41,33,35,22,31,22,20,25,16,20,14,14,13,13,16,13,14,14,14],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
