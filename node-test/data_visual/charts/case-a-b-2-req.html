<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/9/2023, 3:50:00 PM", "9/9/2023, 3:45:01 PM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49","00:03:50"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[1,9,20,29,40,49,50,50,50,50,51,59,70,80,89,99,100,100,100,100,99,111,120,130,139,149,150,150,150,150,151,159,170,180,189,199,200,200,200,200,201,210,219,230,240,248,250,250,250,250,251,260,269,280,290,298,300,300,300,300,301,310,320,329,340,349,350,349,350,350,352,359,370,380,389,399,399,400,400,400,401,410,420,430,439,449,450,450,450,450,450,460,470,479,490,499,500,500,500,500,501,510,519,530,540,548,550,550,550,550,551,559,570,580,589,599,600,600,600,600,601,610,619,630,640,648,650,650,650,650,652,659,670,679,690,698,700,699,702,700,701,709,719,731,739,748,751,747,752,750,752,759,770,780,789,799,799,800,801,800,801,810,819,830,839,848,850,851,850,850,851,858,870,881,889,898,899,901,901,899,902,908,920,929,941,948,951,950,950,950,951,960,970,979,989,999,338,955,1000,1000,997,968,935,900,868,835,801,768,735,701,668,635,601,568,534,501,468,435,401,368,334,302,268,234,201,168,135,101,68,35,4],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[1,9,20,29,40,48,50,50,50,50,51,60,69,79,89,95,103,100,100,98,101,108,119,126,119,121,111,72,89,114,86,98,166,175,187,191,195,199,196,195,199,214,189,151,137,110,248,248,230,258,257,260,261,255,223,230,202,177,181,191,165,188,183,162,124,121,158,173,172,122,142,176,237,236,396,393,399,386,422,391,353,317,284,276,276,275,290,298,283,286,288,300,281,279,273,292,283,273,308,280,320,291,316,355,359,352,366,414,427,406,406,445,439,417,424,415,418,403,414,393,418,426,420,395,417,427,429,389,424,410,434,405,453,399,426,427,431,398,453,391,435,409,407,387,426,398,360,382,370,418,401,405,395,397,406,380,393,357,387,335,422,401,367,377,379,343,341,326,332,361,350,308,322,339,313,288,317,281,280,344,290,285,300,275,251,250,246,274,263,277,282,251,262,242,187,234,130,354,171,227,221,246,277,284,339,371,374,407,441,486,492,549,500,485,385,411,397,412,383,362,338,305,270,237,202,169,135,101,68,35,5],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,26,35,77,63,40,51,78,9,0,2,4,4,1,4,8,2,0,19,63,104,115,48,5,1,3,1,0,3,22,37,74,73,146,122,111,128,124,121,161,198,241,199,195,158,217,223,191,103,138,59,3,4,3,0,2,49,94,138,153,162,174,152,159,169,164,150,166,190,195,218,201,223,221,196,217,191,211,207,173,174,201,184,141,124,148,144,116,119,169,162,181,186,192,189,210,183,178,202,229,228,198,227,266,214,248,217,226,240,270,234,278,257,298,281,296,261,294,308,343,309,347,377,351,390,351,337,346,366,358,395,418,411,428,417,447,412,379,460,458,447,495,499,505,539,474,525,548,518,544,570,587,621,603,594,576,594,643,603,655,692,664,718,683,672,698,648,713,704,714,791,760,238,475,932,786,783,753,657,630,564,485,440,376,338,214,187,129,77,128,153,92,75,24,31,1,2,0,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[8,7,9,7,7,6,7,9,7,7,6,6,7,7,11,14,13,16,18,25,21,26,37,42,72,103,153,140,172,117,149,138,66,56,75,73,94,90,98,99,93,53,101,149,172,163,158,65,59,66,49,53,71,68,110,136,221,217,141,140,163,131,152,152,214,176,175,141,164,199,168,155,148,175,129,51,57,60,58,51,42,43,33,37,36,39,35,37,38,34,36,32,38,43,35,53,45,46,47,49,67,43,47,42,41,40,50,34,33,37,38,36,34,34,34,40,35,39,34,40,44,40,39,50,47,42,54,52,58,73,55,69,73,73,86,112,110,112,95,91,100,103,110,108,104,125,135,128,137,128,127,143,169,155,162,152,162,183,175,190,168,151,187,192,191,199,203,223,217,186,199,213,202,227,243,231,228,227,269,264,234,260,242,239,273,288,258,305,300,252,276,290,282,326,342,318,730,289,447,283,283,263,245,230,232,207,202,157,147,128,113,94,91,77,46,32,30,25,24,20,17,14,13,8,7,7,6,6,7,6,7],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
