<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/10/2023, 9:38:45 AM", "9/10/2023, 9:33:22 AM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49","00:03:50"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[2,11,22,31,42,49,50,50,50,50,52,62,72,81,92,99,100,100,100,100,102,112,121,132,141,150,150,150,150,150,152,162,171,182,191,200,200,200,200,200,202,211,222,232,241,250,250,250,250,249,253,261,272,281,292,299,300,300,300,300,302,312,321,332,342,349,350,350,350,350,352,362,371,382,391,400,400,400,400,400,402,412,421,432,441,450,450,450,450,450,452,461,472,482,491,499,501,499,500,500,503,511,522,531,542,550,549,551,549,550,553,561,572,581,592,599,600,600,600,600,603,611,622,631,642,649,650,650,650,650,652,662,671,682,692,699,700,700,699,701,702,711,722,732,741,750,750,750,749,744,759,762,771,781,792,800,800,800,799,800,803,811,822,831,842,849,851,850,849,850,853,861,872,881,892,899,900,900,900,900,902,912,922,931,941,950,950,949,951,950,952,962,971,982,991,1000,999,1001,999,1000,994,960,929,895,862,828,794,762,728,695,661,628,595,561,529,494,462,428,395,361,328,295,262,228,194,162,128,95,61,29,1],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[1,12,21,31,42,49,50,50,50,50,52,61,72,82,91,96,103,100,100,99,100,110,124,116,123,119,109,116,121,123,124,118,107,113,121,109,122,112,117,157,135,170,214,227,232,239,244,237,243,236,236,248,252,234,236,242,227,240,242,241,241,250,215,243,230,239,238,235,229,228,238,240,233,227,237,216,226,242,226,232,216,241,216,227,304,353,375,331,328,403,455,458,434,480,436,426,449,452,426,422,456,452,468,445,457,456,463,453,451,429,453,449,445,462,450,484,515,568,595,593,610,595,612,618,602,643,602,617,614,621,629,616,605,629,619,599,619,620,605,623,618,616,613,591,622,583,606,592,604,585,618,615,598,594,614,586,610,575,607,608,610,591,559,629,599,586,576,588,585,587,574,573,576,571,559,552,576,556,572,560,543,563,577,589,540,536,551,561,529,582,521,535,559,552,514,571,539,523,552,543,516,580,569,530,568,534,656,570,593,638,605,598,597,558,531,487,462,432,396,361,332,293,265,228,195,162,129,95,63,28,2],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,22,29,44,33,33,24,24,44,56,73,73,91,80,85,92,44,67,38,7,0,10,8,8,11,4,16,17,13,19,43,54,68,67,61,59,52,68,58,94,99,107,119,110,110,123,124,114,118,137,148,164,168,184,158,165,178,175,173,215,221,120,100,83,129,116,38,3,0,23,11,54,76,48,46,77,83,39,57,45,101,77,91,87,103,102,122,97,108,114,138,134,125,89,34,0,0,0,12,13,11,12,34,28,47,30,37,22,56,31,68,75,108,77,71,100,93,63,102,110,144,117,147,161,162,138,124,173,153,163,188,174,222,190,225,188,202,195,225,217,214,252,280,265,260,270,264,270,281,301,321,320,342,335,347,329,329,365,345,347,350,385,409,401,396,431,370,365,457,419,450,463,451,443,479,468,436,438,422,370,366,286,266,177,189,152,46,65,40,2,6,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[65,18,14,14,14,14,14,14,14,13,14,15,14,14,16,23,19,17,14,26,22,25,30,43,48,46,68,55,53,52,49,56,61,66,62,56,60,53,44,49,20,27,31,38,51,45,44,49,46,52,45,45,40,53,53,54,55,51,53,50,56,51,55,58,54,53,58,58,58,63,53,52,53,60,54,60,70,55,59,68,56,62,69,51,35,57,51,28,28,30,34,37,41,39,43,43,46,46,44,48,42,46,42,46,48,49,49,48,46,48,49,46,52,48,39,42,33,35,29,35,35,38,40,43,43,41,40,43,44,41,39,48,40,45,45,54,47,47,51,49,44,51,48,55,51,49,56,57,57,53,62,59,53,58,57,62,55,62,57,59,58,64,55,55,57,70,61,65,66,65,64,67,71,64,70,68,68,73,69,72,77,76,75,80,88,84,94,83,83,79,78,83,65,77,84,73,86,84,81,93,84,75,75,87,73,71,57,68,62,47,54,51,32,34,25,33,21,28,19,18,24,14,15,20,14,14,14,14,14,15,15],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
