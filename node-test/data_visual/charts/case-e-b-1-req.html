<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/9/2023, 6:08:46 PM", "9/9/2023, 6:04:12 PM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[7,18,27,38,47,50,50,50,50,50,57,68,77,88,97,100,100,100,100,100,108,117,128,137,147,150,150,150,150,150,158,167,178,187,197,200,200,200,200,201,207,217,228,237,247,250,250,250,251,250,257,268,277,287,298,300,300,300,300,300,307,318,327,338,347,350,350,350,350,350,358,367,377,388,397,400,400,400,400,400,408,417,427,438,447,450,450,450,450,450,458,467,478,487,498,499,500,501,500,499,508,517,528,538,546,551,550,550,550,550,557,568,577,588,597,600,600,600,600,600,608,617,628,637,647,650,650,650,650,650,657,668,677,688,697,700,700,700,700,700,708,718,727,737,747,751,749,750,750,751,757,768,777,787,797,801,798,802,799,801,807,818,827,837,848,850,850,850,850,850,857,868,878,887,897,899,900,901,899,901,908,917,927,938,947,950,950,950,950,951,957,967,978,987,997,1001,999,1001,998,1000,975,943,908,875,842,808,776,742,708,675,641,610,575,542,508,476,441,409,375,342,308,276,240,210,175,142,109,75,42,9],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[7,17,27,37,47,50,50,50,50,51,57,68,77,86,97,98,103,97,102,99,108,111,117,123,122,119,115,122,116,123,124,131,110,108,106,103,95,107,105,116,100,106,95,105,95,97,93,85,184,228,236,252,256,246,259,258,258,240,241,238,225,251,244,230,228,231,238,236,234,228,233,233,243,219,229,244,243,231,298,286,302,353,368,383,373,384,375,366,374,353,374,369,363,396,423,421,471,491,487,490,492,493,498,477,502,483,481,492,500,491,491,477,477,485,474,471,481,486,474,490,491,475,487,465,484,532,532,561,542,526,592,633,600,623,640,609,613,627,596,588,610,615,602,607,606,588,607,615,620,617,615,575,596,603,582,567,568,643,605,589,610,598,591,597,590,588,568,573,562,584,552,581,546,555,564,572,586,606,579,568,567,551,563,565,554,555,544,541,555,560,528,551,566,489,583,540,534,521,586,535,530,533,586,522,629,562,580,573,652,585,622,595,562,546,505,474,442,413,374,343,310,277,240,212,175,143,109,76,42,10],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,15,24,31,27,34,36,28,33,33,65,82,90,94,105,93,95,86,110,109,126,129,158,156,155,176,61,16,18,23,15,39,36,35,54,55,61,65,79,68,85,100,124,123,114,111,116,110,137,133,132,171,157,160,157,185,93,92,127,61,48,62,76,69,70,88,79,90,92,93,120,81,75,89,24,17,11,8,4,38,18,55,50,75,66,51,57,60,69,83,101,93,126,137,105,117,128,117,109,155,133,165,181,111,111,100,104,114,70,31,76,65,66,90,85,77,95,114,102,103,119,138,131,142,142,145,148,129,146,168,197,187,215,226,177,212,189,225,196,220,227,251,249,269,277,275,287,272,307,289,317,312,273,335,318,353,336,329,345,345,395,356,400,402,393,398,406,384,419,431,399,509,419,469,425,462,451,455,463,397,345,311,249,243,211,124,104,102,10,30,17,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[21,14,14,14,14,14,14,16,14,15,15,16,13,19,19,25,26,24,25,21,27,39,49,43,50,44,51,62,48,49,48,54,63,57,77,79,63,60,80,64,76,66,68,59,78,74,79,31,26,45,47,49,45,65,60,63,57,62,53,50,56,52,52,56,66,54,58,58,53,55,63,59,51,63,58,60,55,53,54,57,47,43,49,51,55,54,53,62,54,54,54,48,39,40,52,41,36,42,40,41,39,49,42,46,45,52,50,48,47,47,49,49,53,52,51,55,50,55,55,51,54,57,51,57,52,42,51,53,54,42,35,44,52,50,51,50,49,49,51,55,49,51,54,53,53,55,53,57,58,53,53,59,59,59,60,64,58,61,59,60,59,62,59,66,62,66,69,73,69,65,73,65,70,72,62,74,70,73,64,69,80,71,70,67,75,73,78,86,77,74,82,85,87,87,85,85,91,79,69,85,88,81,72,71,56,69,62,54,53,55,40,38,40,25,31,23,31,18,17,23,16,14,14,18,13,13,13,14,14,15],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
