<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/9/2023, 4:34:57 PM", "9/9/2023, 4:30:22 PM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[7,17,27,38,46,50,50,50,50,51,57,67,77,87,97,100,100,100,100,101,107,117,127,137,147,150,150,150,150,151,157,167,177,188,196,200,200,200,201,200,207,217,227,238,246,250,250,251,249,251,257,267,277,288,296,301,299,300,300,301,307,317,327,337,348,349,350,350,350,351,357,367,377,386,398,401,400,399,400,401,407,417,427,438,446,450,450,450,450,451,455,469,477,487,498,499,500,500,501,500,507,517,527,538,546,551,549,550,551,550,556,568,577,588,597,599,601,599,600,601,607,617,627,637,648,650,649,651,649,650,658,667,677,688,696,700,701,700,699,701,707,717,727,738,746,751,749,751,750,750,757,767,777,788,797,799,801,799,801,800,806,818,827,837,847,851,849,850,851,850,857,866,878,888,896,900,899,901,900,901,907,917,927,937,948,950,950,949,947,954,957,967,977,988,996,1000,1001,999,1000,1000,976,942,910,876,842,810,775,743,709,676,643,610,576,542,510,476,442,410,376,342,310,276,242,210,176,142,110,76,42,10],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[7,17,27,37,46,50,50,50,50,50,57,68,77,87,97,98,102,99,100,101,106,117,124,135,119,109,108,101,101,106,108,105,91,87,83,68,85,90,67,94,62,96,88,113,140,215,246,255,245,260,253,273,266,274,256,322,294,294,290,301,305,319,327,339,348,345,347,356,350,350,352,368,372,384,388,401,384,345,307,370,356,342,328,313,317,378,426,478,448,442,433,481,480,489,495,500,500,500,496,503,507,510,530,541,539,547,555,551,553,551,554,561,576,589,603,598,594,602,597,599,608,598,638,637,643,627,596,554,485,541,485,490,516,474,504,483,471,473,466,464,480,449,469,455,431,424,436,446,424,415,426,414,422,391,412,381,397,386,410,385,406,361,377,375,335,343,364,350,368,326,335,355,353,345,308,290,346,330,327,320,333,315,306,323,267,315,314,284,225,320,268,289,278,248,279,275,269,219,305,271,237,340,334,289,372,367,367,445,438,458,486,550,590,554,519,477,443,411,374,345,309,278,243,210,176,143,110,77,43,10],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,37,47,48,53,41,43,69,74,102,107,119,128,114,118,117,141,118,160,119,120,31,6,0,0,0,0,0,0,1,33,7,0,14,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,5,48,80,47,47,64,102,113,132,79,35,11,2,2,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,38,79,128,142,166,168,162,208,204,212,231,220,234,233,236,256,236,285,297,336,322,297,329,322,346,342,357,391,369,405,415,398,409,425,402,435,440,452,506,483,519,524,465,499,519,486,543,526,548,602,563,628,558,556,582,607,564,648,620,663,627,690,651,753,627,670,677,760,685,701,734,680,805,753,708,654,611,622,507,489,337,395,289,219,191,82,16,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[23,13,12,11,12,11,12,12,12,12,12,13,14,11,13,14,15,13,14,14,15,13,22,37,82,106,145,116,101,121,115,115,136,135,155,194,171,177,131,158,156,134,142,90,73,61,67,55,48,46,27,25,43,64,83,49,23,24,23,19,20,22,20,23,22,19,25,23,24,23,25,29,34,34,43,56,61,102,106,91,103,91,112,105,110,96,85,56,16,19,18,14,14,14,13,13,15,15,13,16,15,15,15,15,17,18,17,17,16,17,15,19,19,23,23,23,24,29,25,26,30,29,33,43,42,61,83,99,117,133,129,141,140,139,124,126,119,133,142,131,132,123,137,147,198,174,166,158,167,169,175,173,183,178,203,234,190,200,210,177,186,197,211,214,237,254,249,195,210,225,223,245,274,275,260,273,268,292,256,266,307,285,276,300,311,357,347,308,302,326,299,362,355,348,345,384,452,372,428,441,391,401,348,322,299,210,191,204,184,136,115,103,57,38,17,20,12,16,11,12,14,12,11,11,13,12,12,13,12,13],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
