<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 1.2em; color: #333;
    }
    #testTime {
      font-size: 1.2em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: true,
          maintainAspectRatio: false,
          scales: {
            y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 11, title: { display: true, text: 'Pod nums' } },
            y1: { position: 'left', stack: 'left', stackWeight: 2, offset: true, title: { display: true, text: 'users CPU mCores' } },
            y2: { position: 'left', stack: 'left', stackWeight: 2, offset: true, title: { display: true, text: 'orders CPU mCores' } },
            // y2: { position: 'left', stack: 'left', stackWeight: 2, offset: true, title: { display: true, text: 'MiB' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/6/2023, 12:36:49 PM", "9/6/2023, 12:31:17 PM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54"],"datasets":[{"label":"Pod nums","data":[6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11],"borderColor":"lightgray","yAxisID":"y3","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"orders-v1-68b798b5cd-46pt2-CPU","data":[20.13,20.13,20.13,20.13,20.13,20.13,20.13,10.74,10.74,10.74,10.74,10.74,10.74,10.74,10.74,10.74,10.74,10.74,10.74,10.74,10.74,10.74,58.21,58.21,58.21,58.21,58.21,58.21,58.21,58.21,58.21,58.21,58.21,58.21,58.21,58.21,58.21,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,85.6,133.43,133.43,133.43,133.43,133.43,133.43,133.43,133.43,133.43,133.43,133.43,133.43,133.43,133.43,133.43,147.58,147.58,147.58,147.58,147.58,147.58,147.58,147.58,147.58,147.58,147.58,147.58,147.58,147.58,147.58,164.16,164.16,164.16,164.16,164.16,164.16,164.16,164.16,164.16,164.16,164.16,164.16,164.16,164.16,164.16,115.75,115.75,115.75],"borderColor":"orange","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"orders-v1-68b798b5cd-s4tbj-CPU","data":[16.87,16.87,16.87,16.87,16.87,16.87,16.87,15.8,15.8,15.8,15.8,15.8,15.8,15.8,15.8,15.8,15.8,15.8,15.8,15.8,15.8,15.8,62.78,62.78,62.78,62.78,62.78,62.78,62.78,62.78,62.78,62.78,62.78,62.78,62.78,62.78,62.78,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,89.25,134.7,134.7,134.7,134.7,134.7,134.7,134.7,134.7,134.7,134.7,134.7,134.7,134.7,134.7,134.7,214.79,214.79,214.79,214.79,214.79,214.79,214.79,214.79,214.79,214.79,214.79,214.79,214.79,214.79,214.79,206.01,206.01,206.01,206.01,206.01,206.01,206.01,206.01,206.01,206.01,206.01,206.01,206.01,206.01,206.01,125.4,125.4,125.4],"borderColor":"green","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"users-v1-687bcd44cf-mvm2p-CPU","data":[20.63,20.63,20.63,20.63,20.63,20.63,20.63,11.47,11.47,11.47,11.47,11.47,11.47,11.47,11.47,11.47,11.47,11.47,11.47,11.47,11.47,11.47,120.94,120.94,120.94,120.94,120.94,120.94,120.94,120.94,120.94,120.94,120.94,120.94,120.94,120.94,120.94,177.51,177.51,177.51,177.51,177.51,177.51,177.51,177.51,177.51,177.51,177.51,177.51,177.51,177.51,177.51,274.37,274.37,274.37,274.37,274.37,274.37,274.37,274.37,274.37,274.37,274.37,274.37,274.37,274.37,274.37,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,214.83,209.02,209.02,209.02,209.02,209.02,209.02,209.02,209.02,209.02,209.02,209.02,209.02,209.02,209.02,209.02,96.72,96.72,96.72],"borderColor":"#93FF93","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"users-v1-687bcd44cf-vk88c-CPU","data":[15.12,15.12,15.12,15.12,15.12,15.12,15.12,15.32,15.32,15.32,15.32,15.32,15.32,15.32,15.32,15.32,15.32,15.32,15.32,15.32,15.32,15.32,79.18,79.18,79.18,79.18,79.18,79.18,79.18,79.18,79.18,79.18,79.18,79.18,79.18,79.18,79.18,188.68,188.68,188.68,188.68,188.68,188.68,188.68,188.68,188.68,188.68,188.68,188.68,188.68,188.68,188.68,273.12,273.12,273.12,273.12,273.12,273.12,273.12,273.12,273.12,273.12,273.12,273.12,273.12,273.12,273.12,240.11,240.11,240.11,240.11,240.11,240.11,240.11,240.11,240.11,240.11,240.11,240.11,240.11,240.11,240.11,223.98,223.98,223.98,223.98,223.98,223.98,223.98,223.98,223.98,223.98,223.98,223.98,223.98,223.98,223.98,187.06,187.06,187.06,187.06,187.06,187.06,187.06,187.06,187.06,187.06,187.06,187.06,187.06,187.06,187.06,136.52,136.52,136.52],"borderColor":"#9393FF","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"users-v1-687bcd44cf-l289j-CPU","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,257.13,257.13,257.13,257.13,257.13,257.13,257.13,257.13,257.13,257.13,257.13,257.13,257.13,257.13,257.13,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,188.36,188.36,188.36,188.36,188.36,188.36,188.36,188.36,188.36,188.36,188.36,188.36,188.36,188.36,188.36,225.58,225.58,225.58,225.58,225.58,225.58,225.58,225.58,225.58,225.58,225.58,225.58,225.58,225.58,225.58,154.32,154.32,154.32],"borderColor":"#4DFFFF","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"users-v1-687bcd44cf-nmgfr-CPU","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,201.85,201.85,201.85,201.85,201.85,201.85,201.85,201.85,201.85,201.85,201.85,201.85,201.85,201.85,201.85,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,194.35,194.35,194.35,194.35,194.35,194.35,194.35,194.35,194.35,194.35,194.35,194.35,194.35,194.35,194.35,104.88,104.88,104.88],"borderColor":"#467500","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"users-v1-687bcd44cf-nh9bp-CPU","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,240.35,240.35,240.35,240.35,240.35,240.35,240.35,240.35,240.35,240.35,240.35,240.35,240.35,240.35,240.35,209.82,209.82,209.82,209.82,209.82,209.82,209.82,209.82,209.82,209.82,209.82,209.82,209.82,209.82,209.82,207.45,207.45,207.45,207.45,207.45,207.45,207.45,207.45,207.45,207.45,207.45,207.45,207.45,207.45,207.45,126.26,126.26,126.26],"borderColor":"#737300","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"orders-v1-68b798b5cd-xm57l-CPU","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14.27,14.27,14.27,14.27,14.27,14.27,14.27,14.27,14.27,14.27,14.27,14.27,14.27,14.27,14.27,13.13,13.13,13.13],"borderColor":"#BB5E00","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"orders-v1-68b798b5cd-7mbsw-CPU","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,108.88,108.88,108.88],"borderColor":"#B87070","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
