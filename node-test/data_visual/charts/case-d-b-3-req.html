<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/9/2023, 5:39:20 PM", "9/9/2023, 5:34:41 PM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[4,14,24,34,45,50,50,50,50,50,54,64,74,85,94,100,100,100,100,100,104,114,125,134,144,150,150,150,150,150,154,164,175,184,194,200,200,200,200,200,204,215,224,234,244,250,250,250,250,250,255,264,274,284,294,301,299,300,300,300,305,314,324,334,345,350,350,349,351,350,354,364,374,385,394,399,401,400,400,400,404,414,425,434,444,450,450,450,450,450,454,464,475,484,494,500,499,501,500,500,504,514,525,534,544,550,550,550,550,550,554,565,574,584,594,600,600,600,600,601,604,614,624,635,644,650,650,650,650,650,654,664,674,685,694,700,700,700,699,701,703,715,725,734,744,750,749,751,750,750,754,765,774,784,794,800,800,800,800,799,805,815,824,834,844,850,850,850,850,850,855,864,873,882,897,900,901,900,900,899,904,915,924,934,945,948,894,873,866,787,686,674,652,607,654,645,621,677,677,729,743,615,710,719,711,692,716,676,679,627,653,619,586,553,519,486,453,419,386,352,319,286,253,219,186,152,120,86,52,19],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[3,15,24,34,44,50,50,50,49,51,54,62,76,83,95,99,99,101,99,101,101,113,125,118,97,100,104,86,101,84,78,87,74,78,132,163,183,197,198,203,204,209,228,230,236,242,242,215,214,232,222,209,201,203,183,177,161,151,151,176,171,177,167,117,167,196,231,250,263,246,233,272,269,350,331,331,313,328,372,307,356,391,367,366,374,371,377,384,371,361,381,377,370,376,379,413,419,418,442,428,448,411,447,414,458,445,441,432,444,440,431,449,442,455,443,432,454,432,447,432,439,420,458,442,424,443,443,424,427,430,400,428,393,372,352,406,376,425,399,412,354,409,400,351,315,409,372,390,390,358,402,367,372,360,342,340,320,338,349,354,320,305,317,338,295,302,319,306,320,314,298,284,276,290,245,277,244,233,261,295,320,224,287,293,267,300,247,322,332,348,396,461,449,469,405,472,517,431,520,443,422,432,441,456,446,394,555,475,554,471,526,556,568,479,482,437,413,404,393,351,325,288,254,219,187,153,119,87,53,19],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,39,47,43,73,53,60,65,90,88,127,55,46,20,5,2,0,0,0,0,0,1,1,12,22,44,17,29,45,70,81,112,131,117,147,156,130,128,144,147,177,218,171,105,111,76,99,98,159,97,11,61,48,83,73,53,110,15,44,76,65,71,77,75,68,85,84,72,90,111,96,113,93,76,90,55,73,54,102,73,121,88,103,111,117,99,117,125,114,133,125,147,168,150,169,156,154,159,203,174,180,214,210,197,237,216,221,261,227,271,279,362,283,305,298,284,302,322,297,324,371,437,364,362,364,349,373,376,376,405,408,466,453,477,468,438,457,478,488,502,521,523,551,542,542,504,537,566,566,602,582,602,648,654,654,665,571,559,707,619,553,677,568,607,562,517,439,290,213,203,153,234,173,104,246,157,286,321,189,263,263,265,298,161,212,158,180,294,130,157,99,41,55,43,15,1,1,1,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[23,13,10,10,10,9,9,11,9,10,9,10,11,16,18,23,19,25,24,26,29,34,39,62,122,151,191,139,131,202,173,146,124,155,85,140,58,32,30,27,31,27,35,34,49,63,82,100,92,89,92,113,115,130,132,135,127,190,164,130,133,151,141,216,155,121,103,148,122,151,163,166,44,76,104,114,138,135,116,125,85,95,58,40,44,43,34,37,45,35,34,43,39,38,39,38,40,33,35,34,34,35,36,35,35,37,38,37,40,38,40,37,37,39,37,40,39,46,45,42,44,44,49,52,56,58,62,69,62,58,70,71,78,93,115,110,115,116,122,111,129,115,129,142,143,150,144,147,146,170,160,156,167,178,199,210,180,200,185,206,198,223,206,191,207,211,215,223,222,235,236,233,206,235,279,301,262,311,329,297,364,365,373,401,560,615,674,768,755,823,863,839,845,952,999,919,834,813,801,780,753,774,891,788,866,748,812,754,817,825,710,431,188,56,43,41,34,30,23,19,20,14,14,10,13,10,9,9,9,10],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
