<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/9/2023, 4:06:19 PM", "9/9/2023, 3:57:48 PM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[3,13,24,33,43,50,50,50,50,50,54,63,73,84,93,100,100,100,100,100,103,114,123,133,144,150,150,150,150,150,153,163,174,183,193,200,200,200,200,200,204,213,223,234,243,250,250,250,250,250,254,263,273,284,293,300,300,300,300,300,303,313,324,333,343,351,349,350,351,349,354,363,374,383,393,400,400,400,400,400,403,414,423,434,443,450,450,450,450,450,453,464,473,483,494,500,500,499,501,499,504,513,524,533,544,549,550,551,549,550,554,563,573,584,593,600,600,600,598,602,603,614,623,633,644,650,650,649,651,650,653,664,673,683,694,699,700,701,699,701,703,713,723,734,743,750,750,750,744,756,754,763,773,783,794,800,800,800,800,800,803,814,823,834,843,849,851,850,850,849,854,863,874,883,893,901,899,901,900,899,903,914,922,933,945,950,950,949,950,951,949,968,973,984,993,999,1001,1000,1000,1000,988,956,922,889,855,823,789,755,722,689,654,623,590,555,522,489,456,422,389,355,322,289,256,222,189,155,122,89,56,22],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[3,13,23,34,43,50,50,50,50,50,53,63,74,83,86,103,102,100,100,99,104,103,128,134,98,113,107,105,107,100,119,104,90,86,96,75,75,67,79,53,51,56,174,163,232,252,282,266,238,245,246,210,158,149,156,170,166,164,168,172,167,149,156,155,143,153,131,144,128,146,144,131,258,364,352,348,352,382,363,376,332,319,287,281,274,250,234,319,316,272,243,262,240,240,284,216,269,244,273,260,263,248,293,274,404,395,410,392,393,384,341,371,384,347,397,323,334,355,362,366,365,384,379,297,311,330,340,344,347,338,337,375,343,336,385,353,348,367,354,380,372,351,349,367,370,352,354,364,341,340,350,355,373,328,313,356,330,337,333,345,358,322,332,299,309,342,319,303,310,330,294,297,310,298,275,291,276,253,277,314,292,316,321,302,259,273,275,274,274,287,301,235,243,230,233,224,249,211,233,207,233,238,254,340,328,353,379,402,374,360,353,380,357,409,395,388,364,340,351,335,297,281,269,218,193,156,122,89,56,23],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,21,51,36,40,33,60,39,49,78,99,100,120,121,140,120,138,150,153,25,32,9,11,9,12,3,6,7,78,116,121,125,135,130,146,107,150,123,160,161,169,208,188,216,199,228,210,212,221,137,27,32,44,49,32,39,26,81,77,121,164,139,223,198,166,137,194,176,228,240,247,199,242,267,262,226,240,240,269,213,279,140,157,132,164,157,159,213,199,187,230,194,253,293,248,233,236,236,213,260,311,343,329,258,358,298,290,327,305,318,342,301,356,339,337,297,365,327,346,391,345,361,399,405,389,391,432,421,393,384,443,420,506,465,444,474,441,446,492,490,511,544,502,533,536,551,518,550,558,554,600,593,613,620,637,610,607,623,576,599,613,684,656,699,669,659,672,659,698,728,740,788,733,752,825,715,842,760,700,715,602,537,486,433,374,376,348,310,257,225,170,127,116,90,86,42,22,27,5,1,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[8,7,7,8,7,8,7,7,6,6,6,8,8,8,10,21,15,15,17,16,14,31,45,43,97,130,128,135,117,162,102,117,133,162,157,156,224,166,165,215,163,268,236,363,517,528,353,245,161,179,171,151,89,84,120,108,106,107,104,113,101,122,135,186,167,164,203,182,167,170,185,160,133,90,113,119,140,105,105,89,98,90,107,116,113,129,136,112,103,56,46,64,56,60,54,70,83,61,75,68,76,71,67,73,51,57,58,49,41,44,46,46,41,53,50,70,48,56,54,48,52,77,58,99,85,71,78,90,67,93,74,78,80,77,81,80,89,97,91,108,103,103,111,99,127,114,129,139,112,107,105,108,122,128,140,165,152,146,140,142,160,156,164,182,166,176,175,179,165,183,181,189,171,205,192,219,188,233,259,241,202,218,210,226,243,250,259,266,252,271,258,313,292,289,328,282,357,306,334,301,307,279,303,199,197,189,162,146,133,100,88,63,59,51,37,43,38,34,28,23,21,20,14,10,10,7,6,7,6,6],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
