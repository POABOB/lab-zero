<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/9/2023, 5:14:23 PM", "9/9/2023, 5:09:25 PM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[7,16,27,37,47,50,50,50,50,50,57,67,76,87,97,100,100,100,100,100,107,117,127,136,147,150,150,150,150,150,157,167,177,187,196,200,201,200,199,201,206,217,227,237,247,250,250,250,250,250,257,267,276,287,297,300,300,300,300,300,307,317,326,337,347,350,350,350,350,350,357,367,377,387,397,398,401,400,400,401,406,417,427,437,447,449,451,450,450,450,457,467,476,487,497,500,500,500,500,500,507,517,527,536,547,550,550,550,550,550,557,567,577,586,598,599,601,600,600,600,607,616,627,637,647,650,649,651,650,650,657,667,676,687,697,700,700,700,699,701,707,716,728,736,747,750,750,750,750,750,757,766,778,787,797,800,799,800,800,800,807,817,827,836,848,849,850,850,850,850,858,867,876,887,897,900,900,900,900,900,907,917,927,937,946,950,950,950,950,950,956,968,977,987,997,999,1000,1001,1000,998,978,943,911,877,844,811,777,744,710,678,643,611,577,544,510,478,443,411,377,344,310,278,243,211,177,144,110,78,43,11],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[6,17,27,36,47,50,50,50,50,50,56,68,76,86,97,99,100,100,100,96,109,108,114,117,110,89,85,98,86,85,92,99,82,119,199,205,200,201,199,186,133,139,130,140,127,141,159,143,144,155,139,139,158,165,125,160,138,145,143,133,138,132,129,138,150,165,225,232,147,137,124,121,123,103,107,110,134,117,145,108,118,129,99,97,98,107,104,88,105,92,91,118,91,85,120,245,241,244,247,229,232,232,231,250,202,239,219,208,232,243,205,219,241,183,220,227,235,207,240,217,238,243,206,220,184,235,213,218,248,222,245,218,231,238,227,234,193,219,261,226,230,225,208,244,216,228,227,202,237,216,216,205,230,198,188,226,201,205,191,200,203,222,190,193,215,175,207,192,195,189,185,190,182,186,207,206,187,198,189,209,156,184,193,173,185,187,197,174,189,152,201,210,171,162,173,126,149,199,223,177,216,235,246,250,201,225,214,223,233,221,197,218,227,265,236,251,238,248,253,236,220,210,225,185,179,145,113,78,44,11],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,19,29,56,64,51,72,57,68,69,85,62,21,0,0,0,0,16,77,74,95,100,113,110,95,108,104,84,114,124,117,106,181,143,153,151,171,164,163,191,168,202,194,232,118,104,222,213,238,239,248,276,301,287,271,277,273,263,300,291,319,331,356,312,379,350,355,349,383,342,346,439,387,249,264,248,257,266,283,280,297,269,318,347,339,331,327,306,352,345,330,403,374,376,375,386,346,389,378,363,430,422,425,452,425,440,393,430,406,452,444,449,464,474,510,434,492,455,486,474,507,523,500,538,523,552,516,537,532,546,555,589,604,570,608,591,609,613,566,618,631,609,636,652,673,657,642,669,657,661,708,684,682,677,699,714,725,693,735,718,717,745,772,747,752,769,750,824,729,769,795,811,818,901,801,849,732,742,848,750,698,648,691,620,593,530,488,456,449,409,349,283,273,233,212,167,133,108,91,51,39,29,2,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[14,10,10,10,10,10,10,10,10,10,10,11,11,14,25,28,27,26,27,26,27,43,75,88,118,155,156,156,157,170,166,131,135,189,166,74,59,60,65,69,42,39,41,49,42,47,34,41,69,67,89,86,99,119,128,101,136,109,121,119,115,119,157,152,161,142,100,113,115,81,65,93,130,80,105,74,72,66,97,92,106,91,124,122,125,80,144,107,92,77,91,88,75,109,105,69,69,65,54,57,55,89,62,75,71,108,67,77,75,77,90,72,82,132,104,71,66,76,68,80,73,75,91,89,85,101,85,70,94,86,101,92,80,86,85,77,87,85,101,105,96,113,107,136,122,120,136,98,121,107,109,80,104,97,112,116,121,120,117,96,113,138,115,142,134,125,143,142,131,148,143,166,180,172,209,226,212,219,176,169,187,213,172,201,248,249,229,238,257,223,214,254,251,294,260,266,304,315,290,330,337,296,274,298,168,151,142,114,89,116,90,80,69,80,70,60,57,55,43,46,34,33,33,26,26,20,11,9,10,10],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
