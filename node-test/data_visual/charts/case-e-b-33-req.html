<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/10/2023, 9:43:43 AM", "9/10/2023, 9:38:42 AM");
let data={"labels":["00:00:00","00:00:01","00:00:02","00:00:03","00:00:04","00:00:05","00:00:06","00:00:07","00:00:08","00:00:09","00:00:10","00:00:11","00:00:12","00:00:13","00:00:14","00:00:15","00:00:16","00:00:17","00:00:18","00:00:19","00:00:20","00:00:21","00:00:22","00:00:23","00:00:24","00:00:25","00:00:26","00:00:27","00:00:28","00:00:29","00:00:30","00:00:31","00:00:32","00:00:33","00:00:34","00:00:35","00:00:36","00:00:37","00:00:38","00:00:39","00:00:40","00:00:41","00:00:42","00:00:43","00:00:44","00:00:45","00:00:46","00:00:47","00:00:48","00:00:49","00:00:50","00:00:51","00:00:52","00:00:53","00:00:54","00:00:55","00:00:56","00:00:57","00:00:58","00:00:59","00:01:00","00:01:01","00:01:02","00:01:03","00:01:04","00:01:05","00:01:06","00:01:07","00:01:08","00:01:09","00:01:10","00:01:11","00:01:12","00:01:13","00:01:14","00:01:15","00:01:16","00:01:17","00:01:18","00:01:19","00:01:20","00:01:21","00:01:22","00:01:23","00:01:24","00:01:25","00:01:26","00:01:27","00:01:28","00:01:29","00:01:30","00:01:31","00:01:32","00:01:33","00:01:34","00:01:35","00:01:36","00:01:37","00:01:38","00:01:39","00:01:40","00:01:41","00:01:42","00:01:43","00:01:44","00:01:45","00:01:46","00:01:47","00:01:48","00:01:49","00:01:50","00:01:51","00:01:52","00:01:53","00:01:54","00:01:55","00:01:56","00:01:57","00:01:58","00:01:59","00:02:00","00:02:01","00:02:02","00:02:03","00:02:04","00:02:05","00:02:06","00:02:07","00:02:08","00:02:09","00:02:10","00:02:11","00:02:12","00:02:13","00:02:14","00:02:15","00:02:16","00:02:17","00:02:18","00:02:19","00:02:20","00:02:21","00:02:22","00:02:23","00:02:24","00:02:25","00:02:26","00:02:27","00:02:28","00:02:29","00:02:30","00:02:31","00:02:32","00:02:33","00:02:34","00:02:35","00:02:36","00:02:37","00:02:38","00:02:39","00:02:40","00:02:41","00:02:42","00:02:43","00:02:44","00:02:45","00:02:46","00:02:47","00:02:48","00:02:49","00:02:50","00:02:51","00:02:52","00:02:53","00:02:54","00:02:55","00:02:56","00:02:57","00:02:58","00:02:59","00:03:00","00:03:01","00:03:02","00:03:03","00:03:04","00:03:05","00:03:06","00:03:07","00:03:08","00:03:09","00:03:10","00:03:11","00:03:12","00:03:13","00:03:14","00:03:15","00:03:16","00:03:17","00:03:18","00:03:19","00:03:20","00:03:21","00:03:22","00:03:23","00:03:24","00:03:25","00:03:26","00:03:27","00:03:28","00:03:29","00:03:30","00:03:31","00:03:32","00:03:33","00:03:34","00:03:35","00:03:36","00:03:37","00:03:38","00:03:39","00:03:40","00:03:41","00:03:42","00:03:43","00:03:44","00:03:45","00:03:46","00:03:47","00:03:48","00:03:49"],"datasets":[{"label":"Target (rps)","data":["50","50","50","50","50","50","50","50","50","50","100","100","100","100","100","100","100","100","100","100","150","150","150","150","150","150","150","150","150","150","200","200","200","200","200","200","200","200","200","200","250","250","250","250","250","250","250","250","250","250","300","300","300","300","300","300","300","300","300","300","350","350","350","350","350","350","350","350","350","350","400","400","400","400","400","400","400","400","400","400","450","450","450","450","450","450","450","450","450","450","500","500","500","500","500","500","500","500","500","500","550","550","550","550","550","550","550","550","550","550","600","600","600","600","600","600","600","600","600","600","650","650","650","650","650","650","650","650","650","650","700","700","700","700","700","700","700","700","700","700","750","750","750","750","750","750","750","750","750","750","800","800","800","800","800","800","800","800","800","800","850","850","850","850","850","850","850","850","850","850","900","900","900","900","900","900","900","900","900","900","950","950","950","950","950","950","950","950","950","950","1000","1000","1000","1000","1000","1000","1000","1000","1000","1000","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[5,16,26,36,46,50,50,50,50,50,56,66,76,86,96,100,100,100,100,100,105,116,126,136,146,150,150,150,150,150,156,166,176,186,196,200,200,199,201,200,205,216,226,236,246,250,250,250,250,250,256,266,276,286,296,300,300,300,300,300,305,316,326,336,346,349,351,350,350,350,356,366,376,386,396,400,400,400,400,400,405,417,425,436,446,450,450,450,450,450,456,466,476,486,496,500,500,500,500,500,506,516,525,536,544,552,550,550,550,550,556,566,576,586,596,600,600,600,600,600,605,617,625,637,646,650,649,650,649,651,657,665,676,686,696,700,700,700,700,700,706,716,726,735,747,749,749,751,750,751,755,766,776,786,796,800,800,800,800,799,806,817,826,836,846,849,850,851,850,849,857,866,875,886,896,900,900,900,900,900,906,915,927,936,945,951,950,949,951,950,955,967,975,987,995,1000,1000,1000,1000,1000,981,946,914,880,847,814,780,747,712,682,647,614,580,546,515,480,447,413,381,347,313,281,247,213,181,147,113,81,47,13],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[5,16,25,36,46,50,50,50,50,50,55,66,76,86,92,102,101,101,96,102,106,112,116,122,116,127,127,117,110,119,124,126,115,111,122,123,174,168,187,173,184,187,183,176,200,163,175,181,175,165,178,236,245,234,227,231,243,248,250,250,241,242,227,244,217,243,268,302,303,281,342,338,351,354,372,375,374,349,354,367,354,346,400,426,415,434,433,429,429,431,423,447,441,455,430,453,463,450,479,470,476,477,472,477,484,479,478,484,482,482,471,489,560,590,576,599,584,584,577,593,573,597,589,592,600,585,593,621,613,600,613,598,616,609,611,604,590,600,615,603,564,596,597,572,613,564,631,603,589,607,593,588,592,601,602,574,616,582,557,621,604,579,585,576,598,547,576,572,578,588,597,565,574,565,559,574,590,583,564,558,584,549,559,542,561,551,561,560,557,541,545,546,532,526,530,532,529,480,523,536,590,508,531,564,521,634,582,603,605,583,572,607,558,532,528,487,447,414,377,351,317,280,247,216,181,147,115,81,47,14],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,9,14,26,19,30,31,34,38,30,38,61,72,72,86,22,32,11,26,24,27,37,57,55,85,72,72,78,77,81,27,38,50,59,70,62,47,46,65,54,74,98,97,123,111,86,48,46,69,16,24,24,21,37,25,22,56,38,34,64,64,27,9,31,14,16,12,28,18,32,22,40,26,59,57,32,43,25,34,17,53,47,66,51,73,65,79,69,63,93,81,9,1,2,9,15,16,24,11,17,21,44,44,45,63,54,32,37,52,46,63,57,88,86,93,105,92,92,96,121,126,137,173,137,133,155,155,155,137,179,169,189,184,188,224,189,206,207,213,207,246,226,270,246,297,282,278,260,270,248,322,280,323,345,325,314,319,335,301,378,363,328,390,298,433,410,427,411,399,420,433,420,465,471,467,458,520,479,426,448,432,381,330,261,235,198,173,105,93,77,14,24,0,4,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[24,18,14,14,14,14,14,21,14,14,15,14,13,15,22,28,27,24,25,31,28,35,43,42,42,48,50,52,54,47,46,50,55,63,47,42,60,61,45,58,47,49,58,56,66,65,59,53,56,57,46,45,51,54,55,59,61,58,56,54,52,48,54,50,63,43,43,49,50,33,37,45,40,47,49,48,44,49,45,41,39,28,29,35,34,37,36,34,41,38,36,39,46,39,41,42,41,40,40,40,34,44,44,44,41,46,42,47,43,43,43,32,34,31,31,36,37,35,37,35,30,40,38,42,41,44,44,42,40,40,42,45,46,47,43,45,48,43,46,48,47,53,51,54,48,46,51,53,53,51,57,57,57,58,59,62,54,56,56,54,57,62,64,59,58,66,60,60,60,61,55,71,65,69,75,70,68,74,71,81,70,69,66,71,70,83,82,79,69,78,82,79,72,73,81,81,94,102,85,74,66,83,90,75,65,62,59,60,46,48,52,32,43,28,33,23,30,20,27,20,18,19,16,15,15,15,14,14,14,14],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
