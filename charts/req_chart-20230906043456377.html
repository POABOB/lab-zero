<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/6/2023, 12:34:56 PM", "9/6/2023, 12:31:18 PM");
let data={"labels":["00:00","00:01","00:02","00:03","00:04","00:05","00:06","00:07","00:08","00:09","00:10","00:11","00:12","00:13","00:14","00:15","00:16","00:17","00:18","00:19","00:20","00:21","00:22","00:23","00:24","00:25","00:26","00:27","00:28","00:29","00:30","00:31","00:32","00:33","00:34","00:35","00:36","00:37","00:38","00:39","00:40","00:41","00:42","00:43","00:44","00:45","00:46","00:47","00:48","00:49","00:50","00:51","00:52","00:53","00:54","00:55","00:56","00:57","00:58","00:59","01:00","01:01","01:02","01:03","01:04","01:05","01:06","01:07","01:08","01:09","01:10","01:11","01:12","01:13","01:14","01:15","01:16","01:17","01:18","01:19","01:20","01:21","01:22","01:23","01:24","01:25","01:26","01:27","01:28","01:29","01:30","01:31","01:32","01:33","01:34","01:35","01:36","01:37","01:38","01:39","01:40","01:41","01:42","01:43","01:44","01:45","01:46","01:47","01:48","01:49"],"datasets":[{"label":"Target (rps)","data":["30","30","30","30","30","30","30","30","30","30","40","40","40","40","40","40","40","40","40","40","50","50","50","50","50","50","50","50","50","50","60","60","60","60","60","60","60","60","60","60","70","70","70","70","70","70","70","70","70","70","80","80","80","80","80","80","80","80","80","80","90","90","90","90","90","90","90","90","90","90","100","100","100","100","100","100","100","100","100","100","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[3,7,8,22,28,30,30,27,12,28,31,34,35,37,26,40,40,40,40,40,42,43,45,48,49,50,50,50,50,50,51,54,51,56,57,56,60,40,40,42,60,43,15,36,54,56,53,69,70,61,61,74,75,77,79,80,80,79,80,80,79,65,85,88,89,78,42,13,25,87,90,92,88,97,97,83,86,98,98,81,98,95,91,88,84,81,63,71,71,68,62,61,54,55,51,48,44,39,6,33,31,28,24,21,18,15,11,8,4,1],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[0,0,18,22,27,31,30,17,14,35,32,33,34,31,34,39,41,40,40,40,41,44,45,47,49,50,49,51,50,50,50,47,50,65,55,52,62,35,40,45,66,34,15,36,58,52,57,74,70,52,67,77,72,79,81,78,72,89,80,79,70,74,84,89,89,69,42,13,25,95,82,98,86,95,102,76,92,96,94,85,103,95,91,88,83,74,69,71,73,66,60,63,55,55,53,47,45,29,6,40,31,30,24,22,18,15,11,8,4,1],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[0,0,768,13,42,28,13,14,625,233,11,10,16,34,220,11,11,19,9,10,10,11,9,13,10,14,12,27,11,18,14,20,83,56,81,70,48,214,194,220,71,167,484,325,132,115,136,47,11,67,89,35,11,36,17,13,34,42,12,31,28,90,13,13,9,80,121,779,501,43,29,40,59,27,43,94,81,43,38,63,20,19,12,25,12,14,93,46,15,15,83,29,56,18,22,13,19,100,604,264,32,18,17,36,20,21,16,19,17,16],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
