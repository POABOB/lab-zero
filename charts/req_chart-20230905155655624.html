<!DOCTYPE html>
<html>

<head>
  <title>K6 Stress Test Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      width: 90vw;;
      margin: auto;
    }
    .chart-container {
      position: relative;
      width: 100%;
      height: 50vh;
      min-height: 480px;
    }
    span.msg {
      font-weight: bold; color: brown;
    }
    span.times {
      font-size: 0.8em; color: #333;
    }
    #testTime {
      font-size: 0.8em; color: #333; text-align: right; margin-right: 12px;
    }
  </style>
</head>

<body>
  <div>
    <h2>Stress Test</h2>
    <div id="testTime"></div>
  </div>
  <div class="chart-container">
    <canvas id="myChart"></canvas>
  </div>
  <ul id="errList">
  </ul>
  <script>
    function drawChart(data) {
      const chart = new Chart(document.getElementById('myChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: data.labels,
          datasets: data.datasets
        },
        options: {
          animation: false,
          maintainAspectRatio: false,
          scales: {
            // y3: { position: 'left', stack: 'left', stackWeight: 1, offset: true, min: 0, max: 100, title: { display: true, text: 'CPU %' } },
            y1: { position: 'left', stack: 'left', stackWeight: 4, title: { display: true, text: 'req/s' } },
            y2: { position: 'right', grid: { display: false }, title: { display: true, text: 'ms' } },
          }
        }
      });
    }
    function listErrors(errors) {
      const ul = document.getElementById('errList');
      const stats = {};
      errors.forEach(e => {
        const [time, msg] = e.split('\t');
        const key = msg.replace(/tcp ([\d.]+):(\d+)->/, "tcp $1:*->")
        if (stats[key]) {
          stats[key].push(time);
        } else {
          stats[key] = [time];
        }
      });
      Object.keys(stats).forEach(msg => {
        const li = document.createElement('li');
        li.innerHTML = `<span class=msg>${msg}</span><br /><span class=times>${stats[msg].join(',')}</span>`;
        ul.appendChild(li);
      });
    }
    function setChartTitle(title, testTime) {
      document.title = title;
      document.querySelector('h2').innerText = title;
      document.getElementById('testTime').innerText = testTime;
    }
  </script>
  <script>setChartTitle("Stress Test Report - 9/5/2023, 11:56:55 PM", "9/5/2023, 11:52:11 PM");
let data={"labels":["59:59","00:00","00:01","00:02","00:03","00:04","00:05","00:06","00:07","00:08","00:09","00:10","00:11","00:12","00:13","00:14","00:15","00:16","00:17","00:18","00:19","00:20","00:21","00:22","00:23","00:24","00:25","00:26","00:27","00:28","00:29","00:30","00:31","00:32","00:33","00:34","00:35","00:36","00:37","00:38","00:39","00:40","00:41","00:42","00:43","00:44","00:45","00:46","00:47","00:48","00:49","00:50","00:51","00:52","00:53","00:54","00:55","00:56","00:57","00:58","00:59","01:00","01:01","01:02","01:03","01:04","01:05","01:06","01:07","01:08","01:09","01:10","01:11","01:12","01:13","01:14","01:15","01:16","01:17","01:18","01:19","01:20","01:21","01:22","01:23","01:24","01:25","01:26","01:27","01:28","01:29","01:30","01:31","01:32","01:33","01:34","01:35","01:36","01:37","01:38","01:39","01:40","01:41","01:42","01:43","01:44","01:45","01:46","01:47","01:48","01:49","01:50","01:51","01:52","01:53","01:54","01:55","01:56","01:57","01:58","01:59","02:00","02:01","02:02","02:03","02:04","02:05","02:06","02:07","02:08"],"datasets":[{"label":"Target (rps)","data":["30","30","30","30","30","30","30","30","30","30","60","60","60","60","60","60","60","60","60","60","90","90","90","90","90","90","90","90","90","90","120","120","120","120","120","120","120","120","120","120","150","150","150","150","150","150","150","150","150","150","180","180","180","180","180","180","180","180","180","180","210","210","210","210","210","210","210","210","210","210","240","240","240","240","240","240","240","240","240","240","270","270","270","270","270","270","270","270","270","270","300","300","300","300","300","300","300","300","300","300","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"borderColor":"lightgray","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":true,"borderWidth":2,"lineType":"line"},{"label":"Sent (rps)","data":[3,9,15,21,27,30,30,30,30,30,33,39,45,51,57,60,60,60,60,60,63,69,75,61,53,47,50,61,74,90,93,99,105,111,117,96,67,92,80,46,63,111,111,141,147,150,150,150,150,150,153,137,147,164,109,142,132,148,179,118,155,153,174,157,148,163,90,130,184,102,101,153,127,135,92,155,109,136,168,137,162,155,179,123,163,165,180,154,160,152,172,157,196,149,110,136,153,138,200,199,180,164,190,38,148,123,175,142,190,129,172,173,129,151,137,145,135,125,115,105,95,85,75,65,55,45,35,25,15,4],"borderColor":"orange","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Succ (rps)","data":[0,11,15,21,27,29,31,30,30,30,33,39,40,56,57,55,60,65,60,60,51,79,75,14,56,51,49,60,95,111,95,95,109,110,81,92,64,99,78,36,72,103,128,141,154,161,130,172,161,136,151,117,151,152,104,142,133,155,199,100,153,145,182,151,146,172,81,133,192,93,100,154,126,135,91,157,107,142,163,136,170,148,180,121,166,162,184,150,160,152,172,158,195,154,108,133,153,138,202,199,178,168,186,38,148,125,176,147,189,135,165,188,117,164,153,138,153,124,116,105,83,97,75,65,55,45,35,25,15,5],"borderColor":"green","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Fail (rps)","data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"borderColor":"red","yAxisID":"y1","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"},{"label":"Avg Dura (ms)","data":[0,220,23,13,12,68,21,20,14,10,11,20,10,62,20,14,34,30,26,35,57,155,34,91,996,978,928,689,605,244,69,28,39,14,146,389,685,537,548,837,814,490,394,286,191,183,130,103,104,60,68,290,264,208,333,389,324,333,180,401,279,282,241,272,328,275,451,417,241,366,559,316,368,344,522,341,343,408,295,310,311,314,260,361,265,329,247,310,295,301,282,313,245,307,441,337,314,370,248,237,268,275,231,521,523,362,297,311,250,335,244,241,320,258,223,155,45,55,13,167,98,78,10,14,21,15,14,24,13,23],"borderColor":"blue","yAxisID":"y2","backgroundColor":"rgba(0,0,0,0.1)","pointRadius":0,"fill":false,"borderWidth":2,"lineType":"line"}]};drawChart(data);
let errors=[];listErrors(errors);
</script>

</body>

</html>
